# TOI19 range

[üéâ solution.cpp](./toi19_range.cpp)

<img width="350" alt="image" src="https://github.com/krist7599555/toi/assets/19445033/84d7f1c6-da5e-47ca-a795-7161b801600e">

## Observation 1 Segment Tree + Sort

‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏±‡∏ô‡∏°‡∏µ solution ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ fenwick ‡πÅ‡∏´‡∏•‡∏∞ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏Å‡∏ô ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏ô‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏≠‡∏≠‡∏Å‡∏¢‡∏≤‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏â‡∏∞‡∏ô‡∏±‡πâ‡∏ô‡∏´‡∏±‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô segment tree ‡πÄ‡∏≠‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏•‡∏∞‡∏Å‡∏±‡∏ô üôÑ

‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ segment tree ‡∏Å‡πá‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡πÜ‡∏ß‡πà‡∏≤

`size(node {l, r}) = max(node { >=l, <=r }) + 1`

‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏ß‡πÜ‡∏ß‡πà‡∏≤ `[l1, r1]` ‡∏Å‡∏±‡∏ö `[l2, r2]` ‡πÄ‡∏õ‡πá‡∏ô subset ‡∏Å‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á l1, l2, r1, r2 ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏¢‡∏≤‡∏Å‡πÑ‡∏õ ‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£ sort ‡πÄ‡∏≠‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß query ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡∏ô

```text
         ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏™‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô [l1, r1]
         v
[l       r]

‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏°‡∏î [l2, r2]
[l,      r] <= ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà l1 == l2 && r1 == r2
[l,    r]
[l,  r]
[l,r]
  [l,    r] <= ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ l1 < l2 && r1 == r2
               ‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á ‡∏à‡∏≤‡∏Å l ‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ ‡∏ñ‡πâ‡∏≤ r ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô
  [l,  r]
  [l,r]
     [l, r] <= ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ l1 < l2 && r1 == r2
     [l,r]
      [l,r] <= ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ l1 < l2 && r1 == r2
```

‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° `r` ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÑ‡∏´‡∏ô‡πÄ‡∏•‡∏¢‡∏ó‡∏µ‡πà `>r` ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

‡πÄ‡∏£‡∏≤‡∏à‡∏∂‡∏á‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á interval ‡πÑ‡∏ß‡πâ‡πÅ‡∏Ñ‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á `l` ‡∏Å‡πá‡∏û‡∏≠ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ä‡πà‡∏ß‡∏á‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà `l2<l1` ‡∏Å‡πá‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ `[l2, r2]` ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ç‡∏≠‡∏á `[l1, r1]` ‡πÑ‡∏î‡πâ

## Observation 2 Compress Index

‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏°‡∏µ trick ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡∏Ñ‡∏∑‡∏≠ ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡∏°‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å‡πÜ `1e9` ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á array ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡πÅ‡∏Ñ‡πà `400,000` ‡∏ï‡∏±‡∏ß ‡πÄ‡∏•‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ compress index ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢

- sort ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ unique
- ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏ß‡∏ô for ‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà
- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏Å‡πà‡∏≤ ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á idx ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

```cpp
std::vector<int> big_arr;

// copy
std::vector<int> compress(big_arr.begin(), big_arr.end());
// sort
std::sort(compress.begin(), compress.end());
// unique
std::erase(std::unique(compress.begin(), compress.end()), compress.end());
// replace old value with new idx
for (int& val : big_arr) {
  int idx = std::lower_bound(compress.begin(), compress.end(), val) - compress.begin();
  val = idx;
}
```

‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ map ‡∏ó‡∏≥‡∏Å‡πá‡πÑ‡∏î‡πâ

```cpp
std::vector<int> big_arr;
std::map<int,int> compress;
// sort + unique
for (int val : big_arr) compress[val] = 0;
// assign index
int i = 0;
for (auto& p : compress) p.second = i++;
// replace old value with new idx
for (int& val : big_arr) {
  int idx = compress[val];
  val = idx;
}
```
