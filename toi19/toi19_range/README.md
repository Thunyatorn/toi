# TOI19 range

[üéâ solution.cpp](./toi19_range.cpp)

[üéâ solution_segment_tree.cpp](./toi19_range_segment_tree.cpp)

<img width="700" alt="image" src="https://github.com/krist7599555/toi/assets/19445033/84d7f1c6-da5e-47ca-a795-7161b801600e">

## Solution 1 LIS

LIS (longest increasing subsequence)

sort ‡∏ï‡∏≤‡∏° R ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏° -L (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡πà‡∏≠‡∏ô)

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏û‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô

![LIS solution](https://github.com/krist7599555/toi/assets/19445033/37b36bdc-4f76-4f64-80c7-c96e00af74e9)

```python
idx=[2,6];   lis = 2*;      ‡∏ï‡∏≠‡∏ö 1
idx=[6,7];   lis = 6*;      ‡∏ï‡∏≠‡∏ö 1
idx=[3,8];   lis = 6 3*;    ‡∏ï‡∏≠‡∏ö 2
idx=[1,9];   lis = 6 3 1*;  ‡∏ï‡∏≠‡∏ö 3
idx=[7,11];  lis = 7* 3 1;  ‡∏ï‡∏≠‡∏ö 1
idx=[11,13]; lis = 11* 3 1; ‡∏ï‡∏≠‡∏ö 1
idx=[9,13];  lis = 11 9* 1; ‡∏ï‡∏≠‡∏ö 2
```

‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏°‡∏≠‡∏á R ‡∏ô‡∏¥‡πà‡∏á‡πÜ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏¢‡∏±‡∏ö L ‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏∏‡∏ß‡πà‡∏≤ ‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏¢‡∏±‡∏ö L ‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ

‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô ‡∏Å‡πá‡∏Ñ‡∏ß‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡πÑ‡∏î‡πâ‡πÑ‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô (L ‡πÉ‡∏Å‡∏•‡πâ‡πÜ R ‡∏à‡∏∞‡πÄ‡∏à‡∏≠‡πÑ‡∏î‡πâ‡πÑ‡∏ß)

‡∏à‡∏≤‡∏Å‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ longest increasing subsequence ‡πÅ‡∏ö‡∏ö binary search ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÇ‡∏î‡∏¢‡∏ó‡∏¥‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡πÄ‡∏à‡∏≠‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤

---

## Solution 2 Segment tree

Segment Tree _(‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏ï‡∏£‡∏Ç‡∏µ‡πâ‡πÇ‡∏Å‡∏á ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö)_
![image](https://github.com/krist7599555/toi/assets/19445033/1529fa08-a95d-4db3-bd09-42d68682921c)

> ‡∏´‡∏£‡∏∑‡∏≠ fenwick tree ‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏Å‡∏£‡∏≤‡∏ü 45‡∏≠‡∏á‡∏®‡∏≤ ‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏î‡∏π‡∏¢‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÜ
> 
> <img width="400" alt="image" src="https://github.com/krist7599555/toi/assets/19445033/4183e9ca-5d86-4a2f-a8e8-6c860fef92dc">


### Observation 1 Segment Tree + Sort

‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ segment tree ‡∏Å‡πá‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡πÜ‡∏ß‡πà‡∏≤

`size(node {l, r}) = max(node { >=l, <=r }) + 1`

‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏ß‡πÜ‡∏ß‡πà‡∏≤ `[l1, r1]` ‡∏Å‡∏±‡∏ö `[l2, r2]` ‡πÄ‡∏õ‡πá‡∏ô subset ‡∏Å‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á l1, l2, r1, r2 ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏¢‡∏≤‡∏Å‡πÑ‡∏õ ‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£ sort ‡πÄ‡∏≠‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß query ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡∏ô

```python
         ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏™‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô [l1, r1]
         v
[l       r]

‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏°‡∏î [l2, r2]
[l,      r] <= ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà l1 == l2 && r1 == r2
[l,    r]
[l,  r]
[l,r]
  [l,    r] <= ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ l1 < l2 && r1 == r2
               ‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á ‡∏à‡∏≤‡∏Å l ‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ ‡∏ñ‡πâ‡∏≤ r ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô
  [l,  r]
  [l,r]
     [l, r] <= ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ l1 < l2 && r1 == r2
     [l,r]
      [l,r] <= ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ l1 < l2 && r1 == r2
```

‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° `r` ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÑ‡∏´‡∏ô‡πÄ‡∏•‡∏¢‡∏ó‡∏µ‡πà `>r` ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

‡πÄ‡∏£‡∏≤‡∏à‡∏∂‡∏á‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á interval ‡πÑ‡∏ß‡πâ‡πÅ‡∏Ñ‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á `l` ‡∏Å‡πá‡∏û‡∏≠ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ä‡πà‡∏ß‡∏á‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà `l2<l1` ‡∏Å‡πá‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ `[l2, r2]` ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ç‡∏≠‡∏á `[l1, r1]` ‡πÑ‡∏î‡πâ

### Observation 2 Compress Index

‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏°‡∏µ trick ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡∏Ñ‡∏∑‡∏≠ ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡∏°‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å‡πÜ `1e9` ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á array ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡πÅ‡∏Ñ‡πà `400,000` ‡∏ï‡∏±‡∏ß ‡πÄ‡∏•‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ compress index ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢

- sort ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ unique
- ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏ß‡∏ô for ‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà
- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏Å‡πà‡∏≤ ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á idx ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

```cpp
std::vector<int> big_arr;

// copy
std::vector<int> compress(big_arr.begin(), big_arr.end());
// sort
std::sort(compress.begin(), compress.end());
// unique
std::erase(std::unique(compress.begin(), compress.end()), compress.end());
// replace old value with new idx
for (int& val : big_arr) {
  int idx = std::lower_bound(compress.begin(), compress.end(), val) - compress.begin();
  val = idx;
}
```

‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ map ‡∏ó‡∏≥‡∏Å‡πá‡πÑ‡∏î‡πâ

```cpp
std::vector<int> big_arr;
std::map<int,int> compress;
// sort + unique
for (int val : big_arr) compress[val] = 0;
// assign index
int i = 0;
for (auto& p : compress) p.second = i++;
// replace old value with new idx
for (int& val : big_arr) {
  int idx = compress[val];
  val = idx;
}
```
